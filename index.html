<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>贪吃蛇游戏 - 网页版</title>
    <style>
        body { margin: 0; background-color: #333; color: white; font-family: Arial; text-align: center; padding: 20px; }
        #game-container { max-width: 800px; margin: 0 auto; padding: 20px; background-color: #222; border-radius: 10px; }
        h1 { color: #0f0; }
        .note { color: #aaa; font-size: 0.9em; margin-top: 20px; }
        #gameCanvas { 
            background-color: black; 
            border: 2px solid #0f0;
            margin-top: 20px;
        }
        #score {
            font-size: 24px;
            color: yellow;
            margin: 10px 0;
        }
        #controls {
            margin: 20px 0;
            padding: 10px;
            background-color: #444;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>贪吃蛇网页版</h1>
        <div id="score">分数: 0</div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
        
        <div id="controls">
            <p>使用键盘方向键控制蛇的移动</p>
            <p>按空格键暂停/继续游戏</p>
        </div>
        
        <p class="note">这是JavaScript实现的简易网页版。完整的Python版本请使用:</p>
        <pre>python -m pygbag main.py</pre>
    </div>

    <script>
        // 获取画布和上下文
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        
        // 游戏设置
        const gridSize = 20;
        const gridCount = canvas.width / gridSize;
        
        // 颜色设置
        const colors = {
            snake: '#00FF00',  // 绿色蛇身
            food: '#FF0000',   // 红色食物
            wall: '#FFFF00',   // 黄色墙
            text: '#FFFFFF'    // 白色文字
        };
        
        // 蛇的初始位置和移动方向
        let snake = [{x: 5, y: 5}];
        let direction = {x: 1, y: 0};
        let food = {x: 10, y: 10};
        let score = 0;
        let level = 1;
        let walls = [];
        let gameOver = false;
        let paused = false;
        
        // 生成随机食物位置
        function generateFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * gridCount),
                    y: Math.floor(Math.random() * gridCount)
                };
                // 确保食物不在蛇身上
                var foodOnSnake = false;
                for (let part of snake) {
                    if (part.x === newFood.x && part.y === newFood.y) {
                        foodOnSnake = true;
                        break;
                    }
                }
                // 确保食物不在墙上
                var foodOnWall = false;
                for (let wall of walls) {
                    if (wall.x === newFood.x && wall.y === newFood.y) {
                        foodOnWall = true;
                        break;
                    }
                }
            } while (foodOnSnake || foodOnWall);
            
            return newFood;
        }
        
        // 生成墙体
        function generateWalls() {
            let wallsArray = [];
            
            // 第一关没有墙
            if (level === 1) {
                return wallsArray;
            }
            
            // 第三关有中间的十字形墙
            if (level === 3) {
                const center = Math.floor(gridCount / 2);
                // 水平墙
                for (let i = center-2; i <= center+2; i++) {
                    wallsArray.push({x: i, y: center});
                }
                // 垂直墙
                for (let i = center-2; i <= center+2; i++) {
                    if (i !== center) { // 避免重复中心点
                        wallsArray.push({x: center, y: i});
                    }
                }
            }
            
            return wallsArray;
        }
        
        // 检查是否碰到墙
        function checkWallCollision(x, y) {
            // 检查内部墙体
            for (let wall of walls) {
                if (wall.x === x && wall.y === y) {
                    return true;
                }
            }
            
            // 第2关和第3关检查边界
            if (level >= 2) {
                if (x < 0 || x >= gridCount || y < 0 || y >= gridCount) {
                    return true;
                }
            }
            
            return false;
        }
        
        // 键盘控制
        document.addEventListener('keydown', function(e) {
            // 上、右、下、左键改变方向
            if (e.key === 'ArrowUp' && direction.y !== 1) {
                direction = {x: 0, y: -1};
            } else if (e.key === 'ArrowRight' && direction.x !== -1) {
                direction = {x: 1, y: 0};
            } else if (e.key === 'ArrowDown' && direction.y !== -1) {
                direction = {x: 0, y: 1};
            } else if (e.key === 'ArrowLeft' && direction.x !== 1) {
                direction = {x: -1, y: 0};
            } else if (e.key === ' ') { // 空格键暂停/继续
                paused = !paused;
            } else if (e.key === 'Enter' && gameOver) { // 回车键重新开始
                resetGame();
            }
        });
        
        // 游戏更新函数
        function update() {
            if (gameOver || paused) {
                return;
            }
            
            // 计算新的头部位置
            const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
            
            // 处理穿越能力（如果不是在边界判断模式下）
            if (level === 1) {
                if (head.x < 0) head.x = gridCount - 1;
                if (head.x >= gridCount) head.x = 0;
                if (head.y < 0) head.y = gridCount - 1;
                if (head.y >= gridCount) head.y = 0;
            }
            
            // 检查是否撞墙
            if (checkWallCollision(head.x, head.y)) {
                gameOver = true;
                return;
            }
            
            // 检查是否撞到自己
            for (let part of snake) {
                if (head.x === part.x && head.y === part.y) {
                    gameOver = true;
                    return;
                }
            }
            
            // 添加新头部
            snake.unshift(head);
            
            // 检查是否吃到食物
            if (head.x === food.x && head.y === food.y) {
                // 增加分数
                score++;
                scoreElement.textContent = '分数: ' + score;
                
                // 生成新食物
                food = generateFood();
                
                // 检查是否需要升级
                if (score === 10 && level === 1) {
                    level = 2;
                    walls = generateWalls();
                } else if (score === 20 && level === 2) {
                    level = 3;
                    walls = generateWalls();
                }
            } else {
                // 如果没吃到食物，移除尾部
                snake.pop();
            }
        }
        
        // 绘制函数
        function draw() {
            // 清除画布
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制蛇
            ctx.fillStyle = colors.snake;
            for (let part of snake) {
                ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            }
            
            // 绘制食物
            ctx.fillStyle = colors.food;
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
            
            // 绘制墙
            ctx.fillStyle = colors.wall;
            for (let wall of walls) {
                ctx.fillRect(wall.x * gridSize, wall.y * gridSize, gridSize - 2, gridSize - 2);
            }
            
            // 如果是第2关或第3关，绘制边界墙
            if (level >= 2) {
                ctx.strokeStyle = colors.wall;
                ctx.lineWidth = 4;
                ctx.strokeRect(0, 0, canvas.width, canvas.height);
            }
            
            // 绘制关卡信息
            ctx.fillStyle = colors.text;
            ctx.font = '16px Arial';
            ctx.fillText('关卡: ' + level, 10, 20);
            
            // 如果游戏结束，显示游戏结束文字
            if (gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = colors.text;
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('游戏结束!', canvas.width/2, canvas.height/2 - 20);
                ctx.fillText('最终分数: ' + score, canvas.width/2, canvas.height/2 + 20);
                ctx.font = '20px Arial';
                ctx.fillText('按回车键重新开始', canvas.width/2, canvas.height/2 + 60);
            }
            
            // 如果暂停，显示暂停文字
            if (paused && !gameOver) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = colors.text;
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('游戏暂停', canvas.width/2, canvas.height/2);
                ctx.font = '20px Arial';
                ctx.fillText('按空格键继续', canvas.width/2, canvas.height/2 + 40);
            }
        }
        
        // 重置游戏
        function resetGame() {
            snake = [{x: 5, y: 5}];
            direction = {x: 1, y: 0};
            food = generateFood();
            score = 0;
            level = 1;
            walls = [];
            gameOver = false;
            paused = false;
            scoreElement.textContent = '分数: 0';
        }
        
        // 游戏主循环
        function gameLoop() {
            update();
            draw();
            setTimeout(gameLoop, 150); // 调整速度
        }
        
        // 初始化食物并开始游戏
        food = generateFood();
        gameLoop();
    </script>
</body>
</html>